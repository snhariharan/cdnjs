(function(){var n,t,e=[].slice;t=function(n){var t,r,u,o,c,i,a,f,s,l,d,p;return i=function(n){return n},s=function(n){return n.length>0},o=function(n,t,e){var r,u,o;for(u=0,o=n.length;o>u;u++)r=n[u],t=e(t,r);return t},f=function(t){return t instanceof n.Property},c=0,a=1,u=function(n,t){return n===t},l=function(n){return function(t,e){return!t.initial&&n(t.value,e.value)}},r=n.Model=function(e){var o,c,f,s,v,m,y,g;return v=a++,c=u,m=0,s=new n.Bus,y=new n.Bus,o=void 0,g=n.update({initial:!0},[s],function(n,t){var e,r,u,o,c,i;return i=n.value,c=t.source,r=t.f,o=r(i),u=[v],e=o!==i,{source:c,value:o,modStack:u,changed:e}},[y],function(n,t){return t}).skipDuplicates(l(c)).changes().toProperty(),f=g.map(".value").skipDuplicates(c),f.dispatcher.subscribe(function(n){return n.hasValue()?o=n.value():void 0}),f.id||(f.id=v),f.addSyncSource=function(t){return y.plug(t.filter(function(t){return t.changed&&!n._.contains(t.modStack,v)}).doAction(function(){return n.Model.syncCount++}).map(function(n){return d(n,"modStack",n.modStack.concat([v]))}).map(function(n){return p.set(n,f.syncConverter(p.get(n)))}))},f.apply=function(n){return s.plug(n.toEventStream().map(function(t){return{source:n,f:t}})),g.changes().filter(function(t){return t.source!==n}).map(function(n){return n.value})},f.addSource=function(n){return f.apply(n.map(function(n){return function(){return n}}))},f.modify=function(t){return f.apply(n.once(t))},f.set=function(n){return f.modify(function(){return n})},f.get=function(){return o},f.syncEvents=function(){return g.toEventStream()},f.bind=function(n){return this.addSyncSource(n.syncEvents()),n.addSyncSource(this.syncEvents())},f.lens=function(n){var e;return n=t(n),e=r(),this.addSyncSource(f.sampledBy(e.syncEvents(),function(t,e){return p.set(e,n.set(t,e.value))})),e.addSyncSource(this.syncEvents().map(function(t){return p.set(t,n.get(t.value))})),e},f.syncConverter=i,arguments.length>=1&&f.set(e),f},n.Model.syncCount=0,r.combine=function(n){var e,u,o,c,i,a;if("object"!=typeof n)return r(n);if(f(n))return n;e=n instanceof Array?[]:{},i=r(e);for(u in n)a=n[u],o=t.objectLens(u),c=i.lens(o),c.bind(r.combine(a));return i},n.Binding=function(t){var e,r,u,o,c,i,a;return o=t.initValue,u=t.get,e=t.events,a=t.set,c=e.map(u),null!=o?a(o):o=u(),i=n.Model(o),r=i.addSource(c),r.assign(a),i},t=n.Lens=function(n){return"object"==typeof n?n:t.objectLens(n)},t.id=t({get:function(n){return n},set:function(n,t){return t}}),t.objectLens=function(e){var r,u;return u=function(n){return t({get:function(t){return null!=t?t[n]:void 0},set:function(t,e){return d(t,n,e)}})},r=n._.filter(s,e.split(".")),t.compose.apply(t,n._.map(u,r))},t.compose=function(){var n,r;return n=1<=arguments.length?e.call(arguments,0):[],r=function(n,e){return t({get:function(t){return e.get(n.get(t))},set:function(t,r){var u,o;return u=n.get(t),o=e.set(u,r),n.set(t,o)}})},o(n,t.id,r)},p=t.objectLens("value"),d=function(n,t,e){var r,u,o;r=n instanceof Array?[]:{};for(u in n)o=n[u],r[u]=o;return null!=t&&(r[t]=e),r},n},"undefined"!=typeof module&&null!==module?(n=require("baconjs"),module.exports=t(n)):"function"==typeof define&&define.amd?define(["bacon"],t):t(this.Bacon)}).call(this);